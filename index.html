<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Al-Quran Al-Karim â€” Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
<meta name="description" content="Lisez et Ã©coutez le Saint Coran avec traduction"/>
<meta name="theme-color" content="#0a0d14"/>
<link rel="manifest" href="manifest.json"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet"/>
<style>
:root {
  --night: #0a0d14;
  --deep: #0f1520;
  --card: #141b2a;
  --card-hover: #1a2338;
  --gold: #c9a84c;
  --gold-light: #e8c97a;
  --gold-dim: #7a6030;
  --teal: #2a7a6e;
  --teal-light: #3da897;
  --text: #d4c5a0;
  --text-dim: #7a6e5a;
  --white: #f5f0e8;
  --completed: #1a3a2a;
  --completed-border: #2a7a4a;
  --green: #4ade80;
  --radius: 16px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--night);color:var(--text);font-family:'Lato',sans-serif;min-height:100vh;overflow-x:hidden;}
a{text-decoration:none;color:inherit;}
button{cursor:pointer;font-family:inherit;}

/* === BACKGROUND === */
.bg-glow{position:fixed;top:-200px;left:50%;transform:translateX(-50%);width:800px;height:600px;background:radial-gradient(ellipse,rgba(201,168,76,.12),transparent 70%);pointer-events:none;z-index:0;}
.bg-pattern{position:fixed;inset:0;z-index:0;pointer-events:none;}
.bg-pattern svg{position:absolute;inset:0;width:100%;height:100%;opacity:.04;}

/* === VIEWS === */
.view{display:none;}
.view.active{display:block;}

/* === LOADING === */
.loading-overlay{position:fixed;inset:0;background:rgba(10,13,20,.97);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:9999;gap:20px;}
.loading-overlay.show{display:flex;}
.spinner{width:44px;height:44px;border:3px solid rgba(201,168,76,.2);border-top-color:var(--gold);border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-family:'Amiri',serif;color:var(--gold);font-size:1.1rem;}

/* === HEADER === */
.home-header{position:relative;z-index:10;text-align:center;padding:50px 20px 30px;border-bottom:1px solid rgba(201,168,76,.15);}
.moon-icon{font-size:2.8rem;display:block;margin-bottom:10px;animation:float 4s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.arabic-title{font-family:'Amiri',serif;font-size:clamp(1.5rem,4vw,2.4rem);color:var(--gold-light);letter-spacing:.05em;line-height:1.3;margin-bottom:6px;direction:rtl;}
.home-header h1{font-family:'Cinzel',serif;font-size:clamp(1.2rem,3vw,1.8rem);color:var(--white);letter-spacing:.15em;font-weight:600;margin-bottom:4px;text-transform:uppercase;}
.subtitle{color:var(--gold);font-size:.85rem;font-weight:300;letter-spacing:.3em;text-transform:uppercase;margin-bottom:20px;}

/* Progress */
.progress-section{display:flex;align-items:center;justify-content:center;gap:14px;margin-top:16px;flex-wrap:wrap;}
.progress-label{font-family:'Cinzel',serif;font-size:.8rem;color:var(--gold);letter-spacing:.1em;white-space:nowrap;}
.progress-bar-wrap{width:200px;height:5px;background:rgba(201,168,76,.15);border-radius:99px;overflow:hidden;}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,var(--gold-dim),var(--gold-light));border-radius:99px;transition:width .5s;width:0%;}
.progress-count{font-family:'Cinzel',serif;font-size:.8rem;color:var(--gold-light);font-weight:600;}

/* === TABS === */
.tabs{position:relative;z-index:10;display:flex;justify-content:center;gap:0;padding:16px 20px 0;background:linear-gradient(180deg,rgba(201,168,76,.04),transparent);}
.tab-btn{background:none;border:none;color:var(--text-dim);font-family:'Cinzel',serif;font-size:.8rem;letter-spacing:.12em;text-transform:uppercase;padding:10px 24px;border-bottom:2px solid transparent;transition:all .3s;}
.tab-btn.active{color:var(--gold-light);border-bottom-color:var(--gold);}
.tab-btn:hover{color:var(--gold);}

/* === JUZ GRID === */
.grid-section{position:relative;z-index:10;max-width:1100px;margin:0 auto;padding:30px 20px 60px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;}

.juz-card{position:relative;background:var(--card);border:1px solid rgba(201,168,76,.12);border-radius:var(--radius);padding:20px 14px 40px;text-align:center;cursor:pointer;transition:all .3s;overflow:hidden;animation:fadeUp .4s ease both;}
.juz-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold-dim),transparent);opacity:0;transition:opacity .3s;}
.juz-card:hover{background:var(--card-hover);border-color:rgba(201,168,76,.35);transform:translateY(-3px);box-shadow:0 12px 32px rgba(0,0,0,.4);}
.juz-card:hover::before{opacity:1;}
.juz-card.completed{background:var(--completed);border-color:var(--completed-border);}
.juz-card.completed::after{content:'âœ“';position:absolute;top:8px;right:10px;color:var(--green);font-size:.9rem;font-weight:700;}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

.juz-arabic{font-family:'Amiri',serif;font-size:1rem;color:var(--gold-light);display:block;margin-bottom:4px;direction:rtl;}
.juz-label{font-family:'Cinzel',serif;font-size:.6rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.2em;display:block;margin-bottom:6px;}
.juz-number{font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--white);line-height:1;display:block;margin-bottom:10px;}
.listen-badge{display:inline-flex;align-items:center;gap:5px;background:linear-gradient(135deg,rgba(201,168,76,.18),rgba(201,168,76,.06));border:1px solid rgba(201,168,76,.25);color:var(--gold);font-size:.65rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;padding:5px 10px;border-radius:99px;}
.juz-card:hover .listen-badge{background:linear-gradient(135deg,rgba(201,168,76,.3),rgba(201,168,76,.12));border-color:var(--gold);}

.mark-btn{position:absolute;bottom:0;left:0;right:0;background:rgba(74,222,128,.06);border:none;border-top:1px solid rgba(74,222,128,.12);color:var(--green);font-size:.6rem;letter-spacing:.08em;text-transform:uppercase;padding:6px;transition:background .2s;border-radius:0 0 var(--radius) var(--radius);}
.mark-btn:hover{background:rgba(74,222,128,.14);}
.juz-card.completed .mark-btn{background:rgba(74,222,128,.1);color:#86efac;}

/* === SURAH LIST === */
.surah-container{display:none;max-width:700px;margin:0 auto;padding:0 20px 60px;}
.surah-container.active{display:block;}
.search-wrap{padding:0 0 16px;position:relative;}
.search-input{width:100%;background:var(--card);border:1px solid rgba(201,168,76,.2);border-radius:12px;padding:12px 16px 12px 42px;color:var(--white);font-size:.95rem;outline:none;transition:border-color .3s;}
.search-input:focus{border-color:var(--gold);}
.search-input::placeholder{color:var(--text-dim);}
.search-icon{position:absolute;left:14px;top:12px;font-size:1.1rem;color:var(--text-dim);}

.surah-item{display:flex;align-items:center;gap:14px;padding:14px 16px;background:var(--card);border:1px solid rgba(201,168,76,.08);border-radius:12px;margin-bottom:8px;cursor:pointer;transition:all .2s;}
.surah-item:hover{background:var(--card-hover);border-color:rgba(201,168,76,.25);transform:translateX(4px);}
.surah-num{width:38px;height:38px;display:flex;align-items:center;justify-content:center;background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.25);border-radius:10px;font-family:'Cinzel',serif;font-size:.85rem;color:var(--gold);font-weight:600;flex-shrink:0;}
.surah-info{flex:1;min-width:0;}
.surah-name-ar{font-family:'Amiri',serif;font-size:1.15rem;color:var(--gold-light);direction:rtl;text-align:right;}
.surah-name-en{font-size:.78rem;color:var(--text-dim);margin-top:2px;}
.surah-meta{text-align:right;flex-shrink:0;}
.surah-ayah-count{font-size:.7rem;color:var(--text-dim);}
.surah-type{font-size:.6rem;color:var(--teal-light);text-transform:uppercase;letter-spacing:.08em;}

/* === READER VIEW === */
.reader-header{position:sticky;top:0;z-index:100;background:rgba(15,21,32,.97);border-bottom:1px solid rgba(201,168,76,.2);display:flex;align-items:center;padding:12px 16px;gap:12px;backdrop-filter:blur(12px);}
.back-btn{background:rgba(201,168,76,.15);border:1px solid rgba(201,168,76,.3);color:var(--gold-light);font-size:.85rem;padding:10px 18px;border-radius:10px;display:flex;align-items:center;gap:8px;transition:all .2s;flex-shrink:0;font-weight:600;}
.back-btn:hover{border-color:var(--gold);background:rgba(201,168,76,.25);}
.reader-title{flex:1;text-align:center;font-family:'Amiri',serif;font-size:1.2rem;color:var(--gold-light);direction:rtl;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.reader-actions{display:flex;gap:6px;flex-shrink:0;}
.reader-actions button{background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.15);color:var(--gold);width:38px;height:38px;border-radius:10px;font-size:1rem;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.reader-actions button:hover{border-color:var(--gold);background:rgba(201,168,76,.15);}
.reader-actions button.on{background:rgba(201,168,76,.25);border-color:var(--gold);}

.reader-content{max-width:800px;margin:0 auto;padding:10px 16px 200px;min-height:80vh;}

/* Error state */
.error-box{text-align:center;padding:60px 20px;color:var(--text-dim);}
.error-box .err-icon{font-size:3rem;display:block;margin-bottom:16px;}
.error-box h3{color:#e74c3c;font-family:'Cinzel',serif;margin-bottom:8px;font-size:1.1rem;}
.error-box p{margin-bottom:20px;font-size:.9rem;}
.retry-btn{background:var(--gold);color:var(--night);border:none;padding:12px 30px;border-radius:10px;font-size:.9rem;font-weight:700;font-family:'Cinzel',serif;letter-spacing:.08em;}
.retry-btn:hover{filter:brightness(1.1);}

/* Surah Banner in Reader */
.surah-banner{text-align:center;padding:28px 20px;margin:16px 0 20px;background:linear-gradient(180deg,rgba(201,168,76,.08),rgba(201,168,76,.02));border:1px solid rgba(201,168,76,.2);border-radius:var(--radius);position:relative;}
.surah-banner::before,.surah-banner::after{content:'âœ¦';position:absolute;top:50%;color:rgba(201,168,76,.3);font-size:.8rem;}
.surah-banner::before{left:16px;transform:translateY(-50%);}
.surah-banner::after{right:16px;transform:translateY(-50%);}
.surah-banner-name{font-family:'Amiri',serif;font-size:1.8rem;color:var(--gold-light);direction:rtl;margin-bottom:6px;}
.surah-banner-detail{font-size:.75rem;color:var(--text-dim);letter-spacing:.1em;}

.bismillah{text-align:center;font-family:'Amiri',serif;font-size:1.5rem;color:var(--gold);direction:rtl;padding:12px 0 20px;opacity:.9;}

/* Verses */
.verse{padding:16px 14px;border-bottom:1px solid rgba(201,168,76,.06);transition:background .3s;cursor:pointer;border-radius:8px;margin-bottom:2px;}
.verse:hover{background:rgba(201,168,76,.04);}
.verse.playing{background:rgba(201,168,76,.1);border-left:3px solid var(--gold);border-radius:0 8px 8px 0;}
.verse-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.verse-num-badge{display:inline-flex;align-items:center;justify-content:center;min-width:34px;height:34px;padding:0 8px;background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.2);border-radius:50%;font-family:'Amiri',serif;font-size:.85rem;color:var(--gold);}
.verse-play-btn{background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.2);color:var(--gold);font-size:.8rem;padding:6px 12px;border-radius:20px;transition:all .2s;display:flex;align-items:center;gap:4px;}
.verse-play-btn:hover{background:rgba(201,168,76,.2);border-color:var(--gold);}
.verse-arabic{font-family:'Amiri',serif;font-size:clamp(1.3rem,3.5vw,1.7rem);line-height:2.4;color:var(--white);text-align:right;direction:rtl;margin-bottom:10px;word-spacing:4px;}
.verse-translation{font-size:.88rem;color:var(--text-dim);line-height:1.7;padding-left:14px;border-left:2px solid rgba(201,168,76,.15);margin-top:8px;}

/* === AUDIO PLAYER === */
.audio-player{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(180deg,rgba(15,21,32,.98),#080b11);border-top:1px solid rgba(201,168,76,.25);padding:10px 16px 16px;z-index:200;display:none;backdrop-filter:blur(12px);}
.audio-player.show{display:block;}

.player-progress{width:100%;height:4px;background:rgba(201,168,76,.15);border-radius:99px;margin-bottom:10px;cursor:pointer;}
.player-progress-fill{height:100%;background:linear-gradient(90deg,var(--gold-dim),var(--gold));border-radius:99px;transition:width .2s;width:0%;}

.player-main{display:flex;align-items:center;gap:12px;}
.player-info{flex:1;min-width:0;}
.player-surah-name{font-family:'Amiri',serif;color:var(--gold-light);font-size:.95rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.player-ayah-num{color:var(--text-dim);font-size:.7rem;margin-top:2px;}
.player-controls{display:flex;align-items:center;gap:2px;}
.player-controls button{background:none;border:none;color:var(--gold);font-size:1.1rem;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s;}
.player-controls button:hover{background:rgba(201,168,76,.12);}
.play-main{background:linear-gradient(135deg,var(--gold-dim),var(--gold))!important;color:var(--night)!important;width:46px!important;height:46px!important;font-size:1.3rem!important;}
.play-main:hover{filter:brightness(1.15);}
.player-extra{display:flex;align-items:center;gap:2px;}
.player-extra button{background:none;border:none;color:var(--text-dim);font-size:.85rem;width:34px;height:34px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s;}
.player-extra button:hover{color:var(--gold);}
.player-extra button.on{color:var(--gold);}

/* === SETTINGS === */
.settings-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px);}
.settings-overlay.show{display:flex;}
.settings-panel{background:var(--deep);border:1px solid rgba(201,168,76,.2);border-radius:24px 24px 0 0;padding:24px 20px 40px;width:100%;max-width:500px;animation:slideUp .3s ease;}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.settings-handle{width:40px;height:4px;background:rgba(201,168,76,.3);border-radius:99px;margin:0 auto 20px;}
.settings-title{font-family:'Cinzel',serif;font-size:1.1rem;color:var(--gold-light);text-align:center;margin-bottom:20px;letter-spacing:.1em;}
.setting-group{margin-bottom:18px;}
.setting-label{font-size:.75rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.1em;margin-bottom:8px;display:block;}
.setting-select{width:100%;background:var(--card);border:1px solid rgba(201,168,76,.2);border-radius:10px;padding:12px 14px;color:var(--white);font-size:.9rem;outline:none;appearance:none;cursor:pointer;}
.setting-select:focus{border-color:var(--gold);}
.setting-select option{background:var(--deep);color:var(--white);}
.settings-close{display:block;width:100%;background:rgba(201,168,76,.1);border:1px solid rgba(201,168,76,.25);color:var(--gold);font-family:'Cinzel',serif;font-size:.85rem;padding:12px;border-radius:12px;margin-top:10px;letter-spacing:.1em;transition:all .2s;}
.settings-close:hover{background:rgba(201,168,76,.2);}

/* === FOOTER === */
footer{position:relative;z-index:10;text-align:center;padding:24px 20px 36px;border-top:1px solid rgba(201,168,76,.08);}
.footer-dua{font-family:'Amiri',serif;font-size:1rem;color:var(--gold);direction:rtl;margin-bottom:10px;line-height:1.8;}
.footer-credit{font-size:.75rem;color:var(--text-dim);}
.footer-credit a{color:var(--teal-light);}
.footer-credit a:hover{color:var(--gold);}

/* === RESPONSIVE === */
@media(max-width:480px){
  .grid{grid-template-columns:repeat(3,1fr);gap:10px;}
  .juz-number{font-size:1.5rem;}
  .juz-arabic{font-size:.85rem;}
  .listen-badge{font-size:.55rem;padding:4px 7px;}
  .verse-arabic{font-size:1.2rem;line-height:2.1;}
  .reader-header{padding:10px 10px;}
  .back-btn{padding:8px 12px;font-size:.78rem;}
  .player-main{gap:8px;}
  .surah-banner-name{font-size:1.4rem;}
  .tab-btn{padding:10px 16px;font-size:.7rem;}
}
</style>
</head>
<body>

<!-- Background -->
<div class="bg-glow"></div>
<div class="bg-pattern">
  <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
    <defs><pattern id="geo" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
      <polygon points="20,2 38,11 38,29 20,38 2,29 2,11" fill="none" stroke="#c9a84c" stroke-width="0.5"/>
      <polygon points="20,8 32,14 32,26 20,32 8,26 8,14" fill="none" stroke="#c9a84c" stroke-width="0.3"/>
    </pattern></defs>
    <rect width="200" height="200" fill="url(#geo)"/>
  </svg>
</div>

<!-- Loading -->
<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
  <div class="loading-text">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…...</div>
</div>

<!-- ======================== -->
<!-- VIEW: HOME              -->
<!-- ======================== -->
<div class="view active" id="view-home">
  <header class="home-header">
    <span class="moon-icon">ğŸŒ™</span>
    <div class="arabic-title">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
    <h1>Al-Quran Al-Karim</h1>
    <div class="subtitle">Le Noble Coran</div>
    <div class="progress-section">
      <span class="progress-label">Progression</span>
      <div class="progress-bar-wrap">
        <div class="progress-bar-fill" id="progressFill"></div>
      </div>
      <span class="progress-count" id="progressCount">0 / 30</span>
    </div>
  </header>

  <div class="tabs">
    <button class="tab-btn active" id="tab-juz" onclick="switchTab('juz')">ğŸ“– Par Juz</button>
    <button class="tab-btn" id="tab-surah" onclick="switchTab('surah')">ğŸ“‹ Par Sourate</button>
  </div>

  <div class="grid-section" id="juz-section">
    <div class="grid" id="juz-grid"></div>
  </div>

  <div class="surah-container" id="surah-section">
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input class="search-input" type="text" id="searchInput" placeholder="Rechercher une sourate..." oninput="filterSurahs(this.value)"/>
    </div>
    <div id="surah-list"></div>
  </div>

  <footer>
    <div class="footer-dua">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ø±ÙØ¨ÙÙŠØ¹Ù Ù‚ÙÙ„Ù’Ø¨ÙÙŠ ğŸ¤²</div>
    <div class="footer-credit">
      Made with â¤ï¸ by <a href="https://github.com/" target="_blank">Mouhamadou</a> Â· Open Source
    </div>
  </footer>
</div>

<!-- ======================== -->
<!-- VIEW: READER             -->
<!-- ======================== -->
<div class="view" id="view-reader">
  <div class="reader-header">
    <button class="back-btn" id="backBtn" onclick="goHome()">
      â† Retour
    </button>
    <div class="reader-title" id="reader-title">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</div>
    <div class="reader-actions">
      <button onclick="toggleTranslation()" id="btn-trans" class="on" title="Traduction">ğŸŒ</button>
      <button onclick="openSettings()" title="ParamÃ¨tres">âš™ï¸</button>
    </div>
  </div>
  <div class="reader-content" id="reader-content">
    <!-- Verses load here -->
  </div>
</div>

<!-- ======================== -->
<!-- AUDIO PLAYER             -->
<!-- ======================== -->
<div class="audio-player" id="audio-player">
  <div class="player-progress" id="player-progress" onclick="seekAudio(event)">
    <div class="player-progress-fill" id="player-progress-fill"></div>
  </div>
  <div class="player-main">
    <div class="player-info">
      <div class="player-surah-name" id="player-surah">â€”</div>
      <div class="player-ayah-num" id="player-ayah">â€”</div>
    </div>
    <div class="player-controls">
      <button onclick="prevAyah()" title="Verset prÃ©cÃ©dent">â®</button>
      <button class="play-main" onclick="togglePlay()" id="play-btn" title="Lecture / Pause">â–¶</button>
      <button onclick="nextAyah()" title="Verset suivant">â­</button>
    </div>
    <div class="player-extra">
      <button onclick="toggleRepeat()" id="btn-repeat" title="RÃ©pÃ©ter">ğŸ”</button>
    </div>
  </div>
</div>

<!-- ======================== -->
<!-- SETTINGS                 -->
<!-- ======================== -->
<div class="settings-overlay" id="settings-overlay" onclick="if(event.target===this)closeSettings()">
  <div class="settings-panel">
    <div class="settings-handle"></div>
    <div class="settings-title">âš™ï¸ ParamÃ¨tres</div>
    <div class="setting-group">
      <label class="setting-label">ğŸ™ï¸ RÃ©citateur</label>
      <select class="setting-select" id="select-reciter" onchange="changeReciter(this.value)">
        <option value="ar.alafasy">Mishary Rashid Alafasy</option>
        <option value="ar.abdulbasitmurattal">Abdul Basit (Murattal)</option>
        <option value="ar.abdurrahmaansudais">Abdurrahman As-Sudais</option>
        <option value="ar.hudhaify">Ali Al-Hudhaify</option>
        <option value="ar.minshawimujawwad">El-Minshawi (Mujawwad)</option>
      </select>
    </div>
    <div class="setting-group">
      <label class="setting-label">ğŸŒ Traduction</label>
      <select class="setting-select" id="select-translation" onchange="changeTranslation(this.value)">
        <option value="fr.hamidullah">FranÃ§ais â€” Hamidullah</option>
        <option value="en.sahih">English â€” Sahih International</option>
        <option value="en.pickthall">English â€” Pickthall</option>
      </select>
    </div>
    <button class="settings-close" onclick="closeSettings()">âœ“ Fermer</button>
  </div>
</div>

<!-- ======================== -->
<!-- HIDDEN AUDIO ELEMENT     -->
<!-- ======================== -->
<audio id="quran-audio" preload="auto"></audio>

<script>
/* ================================================
   APP STATE
   ================================================ */
const STATE = {
  currentView: 'home',       // 'home' or 'reader'
  readerType: null,           // 'juz' or 'surah'
  readerNum: null,            // juz/surah number
  ayahs: [],
  translations: [],
  currentIdx: 0,
  isPlaying: false,
  repeatOne: false,
  showTranslation: true,
  reciter: localStorage.getItem('q_reciter') || 'ar.alafasy',
  transEdition: localStorage.getItem('q_trans') || 'fr.hamidullah',
  completed: JSON.parse(localStorage.getItem('q_done') || '[]'),
  surahListData: null,
  cache: {}
};

const API_BASE = 'https://api.alquran.cloud/v1';
const AUDIO_BASE = 'https://cdn.islamic.network/quran/audio/128';
const audioEl = document.getElementById('quran-audio');

const JUZ_AR = [
  'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø«','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø¹','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Ù…Ø³',
  'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¯Ø³','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ø¹','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù…Ù†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªØ§Ø³Ø¹','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ø§Ø´Ø±',
  'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±',
  'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù…Ù† Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªØ§Ø³Ø¹ Ø¹Ø´Ø±','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ø´Ø±ÙˆÙ†',
  'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø« ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø®Ø§Ù…Ø³ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†',
  'Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¯Ø³ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù…Ù† ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ØªØ§Ø³Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†','Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«ÙˆÙ†'
];

/* ================================================
   VIEW MANAGEMENT (le fix principal !)
   ================================================ */
function showView(name) {
  // DÃ©sactiver toutes les vues
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  // Activer la bonne vue
  document.getElementById('view-' + name).classList.add('active');
  STATE.currentView = name;
  window.scrollTo(0, 0);
  console.log('ğŸ“Œ Vue active:', name);
}

/* ================================================
   LOADING
   ================================================ */
function showLoading() { document.getElementById('loading').classList.add('show'); }
function hideLoading() { document.getElementById('loading').classList.remove('show'); }

/* ================================================
   PROGRESS
   ================================================ */
function saveCompleted() {
  localStorage.setItem('q_done', JSON.stringify(STATE.completed));
  updateProgress();
}

function updateProgress() {
  const n = STATE.completed.length;
  document.getElementById('progressFill').style.width = (n / 30 * 100) + '%';
  document.getElementById('progressCount').textContent = n + ' / 30';
}

function toggleDone(num, e) {
  e.stopPropagation();
  const idx = STATE.completed.indexOf(num);
  if (idx === -1) STATE.completed.push(num);
  else STATE.completed.splice(idx, 1);
  saveCompleted();
  renderJuzGrid();
}

/* ================================================
   ARABIC NUMERALS
   ================================================ */
function toAr(n) {
  const d = 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©';
  return String(n).split('').map(c => d[+c] || c).join('');
}

/* ================================================
   API FETCH
   ================================================ */
async function apiFetch(endpoint) {
  console.log('ğŸŒ Fetching:', API_BASE + endpoint);
  const res = await fetch(API_BASE + endpoint);
  if (!res.ok) throw new Error('API Error: ' + res.status);
  const json = await res.json();
  if (json.code !== 200) throw new Error('API returned: ' + json.code);
  return json.data;
}

async function loadJuzData(num) {
  const key = 'juz_' + num + '_' + STATE.transEdition;
  if (STATE.cache[key]) return STATE.cache[key];

  showLoading();
  try {
    const [arData, trData] = await Promise.all([
      apiFetch('/juz/' + num + '/quran-uthmani'),
      apiFetch('/juz/' + num + '/' + STATE.transEdition)
    ]);
    const result = { ayahs: arData.ayahs, translations: trData.ayahs };
    STATE.cache[key] = result;
    console.log('âœ… Juz', num, 'loaded:', result.ayahs.length, 'ayahs');
    return result;
  } finally {
    hideLoading();
  }
}

async function loadSurahData(num) {
  const key = 'surah_' + num + '_' + STATE.transEdition;
  if (STATE.cache[key]) return STATE.cache[key];

  showLoading();
  try {
    const [arData, trData] = await Promise.all([
      apiFetch('/surah/' + num + '/quran-uthmani'),
      apiFetch('/surah/' + num + '/' + STATE.transEdition)
    ]);
    const result = { ayahs: arData.ayahs, translations: trData.ayahs };
    STATE.cache[key] = result;
    console.log('âœ… Surah', num, 'loaded:', result.ayahs.length, 'ayahs');
    return result;
  } finally {
    hideLoading();
  }
}

async function loadSurahList() {
  if (STATE.surahListData) return STATE.surahListData;
  const data = await apiFetch('/surah');
  STATE.surahListData = data;
  return data;
}

/* ================================================
   NAVIGATION
   ================================================ */
function goHome() {
  console.log('ğŸ  Going home');
  audioEl.pause();
  STATE.isPlaying = false;
  showView('home');
  document.getElementById('audio-player').classList.remove('show');
  updatePlayerBtn();
}

async function openJuz(num) {
  console.log('ğŸ“– Opening Juz', num);
  showView('reader');
  STATE.readerType = 'juz';
  STATE.readerNum = num;
  document.getElementById('reader-title').textContent = JUZ_AR[num - 1];
  document.getElementById('reader-content').innerHTML =
    '<div style="text-align:center;padding:80px 20px;color:var(--text-dim);font-family:Amiri,serif;font-size:1.2rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...<br><br><div class="spinner" style="margin:0 auto;"></div></div>';

  try {
    const data = await loadJuzData(num);
    STATE.ayahs = data.ayahs;
    STATE.translations = data.translations;
    STATE.currentIdx = 0;
    renderVerses();
  } catch (err) {
    console.error('âŒ Error loading juz:', err);
    document.getElementById('reader-content').innerHTML =
      '<div class="error-box"><span class="err-icon">âŒ</span><h3>Erreur de chargement</h3><p>VÃ©rifiez votre connexion internet</p><button class="retry-btn" onclick="openJuz(' + num + ')">ğŸ”„ RÃ©essayer</button></div>';
  }
}

async function openSurah(num) {
  console.log('ğŸ“– Opening Surah', num);
  showView('reader');
  STATE.readerType = 'surah';
  STATE.readerNum = num;
  document.getElementById('reader-content').innerHTML =
    '<div style="text-align:center;padding:80px 20px;color:var(--text-dim);font-family:Amiri,serif;font-size:1.2rem;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...<br><br><div class="spinner" style="margin:0 auto;"></div></div>';

  try {
    const data = await loadSurahData(num);
    STATE.ayahs = data.ayahs;
    STATE.translations = data.translations;
    STATE.currentIdx = 0;
    document.getElementById('reader-title').textContent = data.ayahs[0].surah.name;
    renderVerses();
  } catch (err) {
    console.error('âŒ Error loading surah:', err);
    document.getElementById('reader-content').innerHTML =
      '<div class="error-box"><span class="err-icon">âŒ</span><h3>Erreur de chargement</h3><p>VÃ©rifiez votre connexion internet</p><button class="retry-btn" onclick="openSurah(' + num + ')">ğŸ”„ RÃ©essayer</button></div>';
  }
}

/* ================================================
   RENDER: JUZ GRID
   ================================================ */
function renderJuzGrid() {
  const grid = document.getElementById('juz-grid');
  grid.innerHTML = '';
  for (let i = 1; i <= 30; i++) {
    const done = STATE.completed.includes(i);
    const card = document.createElement('div');
    card.className = 'juz-card' + (done ? ' completed' : '');
    card.style.animationDelay = (Math.min(i, 15) * 0.03) + 's';
    card.innerHTML =
      '<span class="juz-arabic">' + JUZ_AR[i - 1].split(' ').slice(0, 2).join(' ') + '</span>' +
      '<span class="juz-label">Juz</span>' +
      '<span class="juz-number">' + String(i).padStart(2, '0') + '</span>' +
      '<span class="listen-badge">ğŸ“– Lire & Ã‰couter</span>' +
      '<button class="mark-btn" onclick="toggleDone(' + i + ',event)">' + (done ? 'âœ“ TerminÃ©' : '+ Marquer lu') + '</button>';
    card.addEventListener('click', () => openJuz(i));
    grid.appendChild(card);
  }
  updateProgress();
}

/* ================================================
   RENDER: SURAH LIST
   ================================================ */
async function renderSurahList() {
  const container = document.getElementById('surah-list');
  if (container.children.length > 0) return;
  
  try {
    container.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-dim)">Chargement des sourates...</div>';
    const surahs = await loadSurahList();
    container.innerHTML = '';
    surahs.forEach(s => {
      const item = document.createElement('div');
      item.className = 'surah-item';
      item.dataset.search = (s.name + ' ' + s.englishName + ' ' + s.englishNameTranslation + ' ' + s.number).toLowerCase();
      item.innerHTML =
        '<div class="surah-num">' + s.number + '</div>' +
        '<div class="surah-info">' +
          '<div class="surah-name-ar">' + s.name + '</div>' +
          '<div class="surah-name-en">' + s.englishName + ' â€” ' + s.englishNameTranslation + '</div>' +
        '</div>' +
        '<div class="surah-meta">' +
          '<div class="surah-ayah-count">' + s.numberOfAyahs + ' versets</div>' +
          '<div class="surah-type">' + (s.revelationType === 'Meccan' ? 'Mecquoise' : 'MÃ©dinoise') + '</div>' +
        '</div>';
      item.addEventListener('click', () => openSurah(s.number));
      container.appendChild(item);
    });
  } catch (err) {
    container.innerHTML = '<div style="text-align:center;padding:30px;color:#e74c3c;">Erreur de chargement</div>';
  }
}

function filterSurahs(q) {
  q = q.toLowerCase().trim();
  document.querySelectorAll('.surah-item').forEach(item => {
    item.style.display = (!q || item.dataset.search.includes(q)) ? '' : 'none';
  });
}

/* ================================================
   RENDER: VERSES (le cÅ“ur de l'app !)
   ================================================ */
function renderVerses() {
  const content = document.getElementById('reader-content');
  content.innerHTML = '';
  let currentSurahNum = null;

  STATE.ayahs.forEach((ayah, idx) => {
    // Surah banner when surah changes
    if (ayah.surah.number !== currentSurahNum) {
      currentSurahNum = ayah.surah.number;

      const banner = document.createElement('div');
      banner.className = 'surah-banner';
      banner.innerHTML =
        '<div class="surah-banner-name">' + ayah.surah.name + '</div>' +
        '<div class="surah-banner-detail">' + ayah.surah.englishName + ' â€¢ ' +
        ayah.surah.numberOfAyahs + ' versets â€¢ ' +
        (ayah.surah.revelationType === 'Meccan' ? 'Mecquoise' : 'MÃ©dinoise') + '</div>';
      content.appendChild(banner);

      // Bismillah (not for surah 1 (in verse) and not for surah 9)
      if (ayah.surah.number !== 9 && ayah.surah.number !== 1) {
        const bis = document.createElement('div');
        bis.className = 'bismillah';
        bis.textContent = 'Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù';
        content.appendChild(bis);
      }
    }

    // Verse element
    const verse = document.createElement('div');
    verse.className = 'verse';
    verse.id = 'v-' + idx;

    let html =
      '<div class="verse-head">' +
        '<span class="verse-num-badge">' + toAr(ayah.numberInSurah) + '</span>' +
        '<button class="verse-play-btn" onclick="event.stopPropagation();playAyah(' + idx + ')">â–¶ Ã‰couter</button>' +
      '</div>' +
      '<div class="verse-arabic">' + ayah.text + ' ï´¿' + toAr(ayah.numberInSurah) + 'ï´¾</div>';

    if (STATE.showTranslation && STATE.translations[idx]) {
      html += '<div class="verse-translation">' + STATE.translations[idx].text + '</div>';
    }

    verse.innerHTML = html;
    verse.addEventListener('click', () => playAyah(idx));
    content.appendChild(verse);
  });

  // Spacer for audio player
  const spacer = document.createElement('div');
  spacer.style.height = '120px';
  content.appendChild(spacer);

  // Show audio player
  document.getElementById('audio-player').classList.add('show');

  console.log('âœ… Rendered', STATE.ayahs.length, 'verses');
}

/* ================================================
   AUDIO PLAYER
   ================================================ */
function getAudioUrl(ayahNumber) {
  return AUDIO_BASE + '/' + STATE.reciter + '/' + ayahNumber + '.mp3';
}

function playAyah(idx) {
  if (idx < 0 || idx >= STATE.ayahs.length) return;
  STATE.currentIdx = idx;
  const ayah = STATE.ayahs[idx];
  const url = getAudioUrl(ayah.number);
  console.log('ğŸ”Š Playing ayah', ayah.number, 'â†’', url);

  audioEl.src = url;
  audioEl.play().then(() => {
    STATE.isPlaying = true;
    updatePlayerBtn();
  }).catch(err => {
    console.error('Audio error:', err);
  });

  highlightVerse(idx);
  updatePlayerInfo();
  document.getElementById('audio-player').classList.add('show');
}

function togglePlay() {
  if (!STATE.ayahs.length) return;
  if (STATE.isPlaying) {
    audioEl.pause();
    STATE.isPlaying = false;
  } else {
    if (!audioEl.src || audioEl.src === window.location.href) {
      playAyah(0);
      return;
    }
    audioEl.play().catch(() => {});
    STATE.isPlaying = true;
  }
  updatePlayerBtn();
}

function nextAyah() {
  if (STATE.currentIdx < STATE.ayahs.length - 1) playAyah(STATE.currentIdx + 1);
}

function prevAyah() {
  if (STATE.currentIdx > 0) playAyah(STATE.currentIdx - 1);
}

function toggleRepeat() {
  STATE.repeatOne = !STATE.repeatOne;
  document.getElementById('btn-repeat').classList.toggle('on', STATE.repeatOne);
}

function updatePlayerBtn() {
  document.getElementById('play-btn').textContent = STATE.isPlaying ? 'â¸' : 'â–¶';
}

function updatePlayerInfo() {
  if (STATE.ayahs.length && STATE.ayahs[STATE.currentIdx]) {
    const a = STATE.ayahs[STATE.currentIdx];
    document.getElementById('player-surah').textContent = a.surah.name + ' â€” ' + a.surah.englishName;
    document.getElementById('player-ayah').textContent = 'Verset ' + a.numberInSurah + ' sur ' + a.surah.numberOfAyahs;
  }
}

function highlightVerse(idx) {
  document.querySelectorAll('.verse.playing').forEach(el => el.classList.remove('playing'));
  const el = document.getElementById('v-' + idx);
  if (el) {
    el.classList.add('playing');
    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

function seekAudio(e) {
  const bar = document.getElementById('player-progress');
  const pct = e.offsetX / bar.offsetWidth;
  if (audioEl.duration) audioEl.currentTime = pct * audioEl.duration;
}

// Audio events
audioEl.addEventListener('timeupdate', () => {
  if (audioEl.duration) {
    const pct = (audioEl.currentTime / audioEl.duration) * 100;
    document.getElementById('player-progress-fill').style.width = pct + '%';
  }
});

audioEl.addEventListener('ended', () => {
  if (STATE.repeatOne) {
    audioEl.currentTime = 0;
    audioEl.play().catch(() => {});
  } else if (STATE.currentIdx < STATE.ayahs.length - 1) {
    playAyah(STATE.currentIdx + 1);
  } else {
    STATE.isPlaying = false;
    updatePlayerBtn();
  }
});

audioEl.addEventListener('error', () => {
  console.error('âŒ Audio failed to load');
  STATE.isPlaying = false;
  updatePlayerBtn();
});

/* ================================================
   TABS
   ================================================ */
function switchTab(tab) {
  document.getElementById('tab-juz').classList.toggle('active', tab === 'juz');
  document.getElementById('tab-surah').classList.toggle('active', tab === 'surah');
  document.getElementById('juz-section').style.display = tab === 'juz' ? '' : 'none';
  
  const surahEl = document.getElementById('surah-section');
  if (tab === 'surah') {
    surahEl.classList.add('active');
    renderSurahList();
  } else {
    surahEl.classList.remove('active');
  }
}

/* ================================================
   TRANSLATION TOGGLE
   ================================================ */
function toggleTranslation() {
  STATE.showTranslation = !STATE.showTranslation;
  document.getElementById('btn-trans').classList.toggle('on', STATE.showTranslation);
  if (STATE.currentView === 'reader' && STATE.ayahs.length) {
    renderVerses();
  }
}

/* ================================================
   SETTINGS
   ================================================ */
function openSettings() {
  document.getElementById('settings-overlay').classList.add('show');
}

function closeSettings() {
  document.getElementById('settings-overlay').classList.remove('show');
}

function changeReciter(val) {
  STATE.reciter = val;
  localStorage.setItem('q_reciter', val);
  if (STATE.isPlaying) playAyah(STATE.currentIdx);
}

function changeTranslation(val) {
  STATE.transEdition = val;
  localStorage.setItem('q_trans', val);
  STATE.cache = {};
  // Reload current content with new translation
  if (STATE.currentView === 'reader' && STATE.readerNum) {
    if (STATE.readerType === 'juz') openJuz(STATE.readerNum);
    else openSurah(STATE.readerNum);
  }
}

/* ================================================
   KEYBOARD SHORTCUTS
   ================================================ */
document.addEventListener('keydown', e => {
  if (STATE.currentView !== 'reader') return;
  if (e.key === ' ' || e.code === 'Space') { e.preventDefault(); togglePlay(); }
  if (e.key === 'ArrowRight') nextAyah();
  if (e.key === 'ArrowLeft') prevAyah();
  if (e.key === 'Escape') goHome();
});

/* ================================================
   INIT
   ================================================ */
(function init() {
  console.log('ğŸ•Œ Quran App â€” Initializing...');
  
  // Restore settings
  document.getElementById('select-reciter').value = STATE.reciter;
  document.getElementById('select-translation').value = STATE.transEdition;
  document.getElementById('btn-trans').classList.toggle('on', STATE.showTranslation);
  
  // Render home
  renderJuzGrid();
  
  console.log('âœ… App ready!');
})();

/* ================================================
   SERVICE WORKER
   ================================================ */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>
</body>
</html>
